<?php

namespace EasyExcel\Metadata\Style;

class Color
{
    // Colors
    public const LIGHTPINK = 'FFFFB6C1';
    public const PINK = 'FFFFC0CB';
    public const CRIMSON = 'FFDC143C';
    public const LAVENDERBLUSH = 'FFFFF0F5';
    public const PALEVIOLETRED = 'FFDB7093';
    public const HOTPINK = 'FFFF69B4';
    public const DEEPPINK = 'FFFF1493';
    public const MEDIUMVIOLETRED = 'FFC71585';
    public const ORCHID = 'FFDA70D6';
    public const THISTLE = 'FFD8BFD8';
    public const PLUM = 'FFDDA0DD';
    public const VIOLET = 'FFEE82EE';
    public const MAGENTA = 'FFFF00FF';
    public const FUCHSIA = 'FFFF00FF';
    public const DARKMAGENTA = 'FF8B008B';
    public const PURPLE = 'FF800080';
    public const MEDIUMORCHID = 'FFBA55D3';
    public const DARKVIOLET = 'FF9400D3';
    public const DARKORCHID = 'FF9932CC';
    public const INDIGO = 'FF4B0082';
    public const BLUEVIOLET = 'FF8A2BE2';
    public const MEDIUMPURPLE = 'FF9370DB';
    public const MEDIUMSLATEBLUE = 'FF7B68EE';
    public const SLATEBLUE = 'FF6A5ACD';
    public const DARKSLATEBLUE = 'FF483D8B';
    public const LAVENDER = 'FFE6E6FA';
    public const GHOSTWHITE = 'FFF8F8FF';
    public const BLUE = 'FF0000FF';
    public const MEDIUMBLUE = 'FF0000CD';
    public const MIDNIGHTBLUE = 'FF191970';
    public const DARKBLUE = 'FF00008B';
    public const NAVY = 'FF000080';
    public const ROYALBLUE = 'FF4169E1';
    public const CORNFLOWERBLUE = 'FF6495ED';
    public const LIGHTSTEELBLUE = 'FFB0C4DE';
    public const LIGHTSLATEGRAY = 'FF778899';
    public const SLATEGRAY = 'FF708090';
    public const DODGERBLUE = 'FF1E90FF';
    public const ALICEBLUE = 'FFF0F8FF';
    public const STEELBLUE = 'FF4682B4';
    public const LIGHTSKYBLUE = 'FF87CEFA';
    public const SKYBLUE = 'FF87CEEB';
    public const DEEPSKYBLUE = 'FF00BFFF';
    public const LIGHTBLUE = 'FFADD8E6';
    public const POWDERBLUE = 'FFB0E0E6';
    public const CADETBLUE = 'FF5F9EA0';
    public const AZURE = 'FFF0FFFF';
    public const LIGHTCYAN = 'FFE1FFFF';
    public const PALETURQUOISE = 'FFAFEEEE';
    public const CYAN = 'FF00FFFF';
    public const AQUA = 'FF00FFFF';
    public const DARKTURQUOISE = 'FF00CED1';
    public const DARKSLATEGRAY = 'FF2F4F4F';
    public const DARKCYAN = 'FF008B8B';
    public const TEAL = 'FF008080';
    public const MEDIUMTURQUOISE = 'FF48D1CC';
    public const LIGHTSEAGREEN = 'FF20B2AA';
    public const TURQUOISE = 'FF40E0D0';
    public const AQUAMARINE = 'FF7FFFAA';
    public const MEDIUMAQUAMARINE = 'FF00FA9A';
    public const MEDIUMSPRINGGREEN = 'FFF5FFFA';
    public const MINTCREAM = 'FF00FF7F';
    public const SPRINGGREEN = 'FF3CB371';
    public const SEAGREEN = 'FF2E8B57';
    public const HONEYDEW = 'FFF0FFF0';
    public const LIGHTGREEN = 'FF90EE90';
    public const PALEGREEN = 'FF98FB98';
    public const DARKSEAGREEN = 'FF8FBC8F';
    public const LIMEGREEN = 'FF32CD32';
    public const LIME = 'FF00FF00';
    public const FORESTGREEN = 'FF228B22';
    public const GREEN = 'FF008000';
    public const DARKGREEN = 'FF006400';
    public const CHARTREUSE = 'FF7FFF00';
    public const LAWNGREEN = 'FF7CFC00';
    public const GREENYELLOW = 'FFADFF2F';
    public const OLIVEDRAB = 'FF556B2F';
    public const BEIGE = 'FF6B8E23';
    public const LIGHTGOLDENRODYELLOW = 'FFFAFAD2';
    public const IVORY = 'FFFFFFF0';
    public const LIGHTYELLOW = 'FFFFFFE0';
    public const YELLOW = 'FFFFFF00';
    public const OLIVE = 'FF808000';
    public const DARKKHAKI = 'FFBDB76B';
    public const LEMONCHIFFON = 'FFFFFACD';
    public const PALEGOLDENROD = 'FFEEE8AA';
    public const KHAKI = 'FFF0E68C';
    public const GOLD = 'FFFFD700';
    public const CORNSILK = 'FFFFF8DC';
    public const GOLDENROD = 'FFDAA520';
    public const FLORALWHITE = 'FFFFFAF0';
    public const OLDLACE = 'FFFDF5E6';
    public const WHEAT = 'FFF5DEB3';
    public const MOCCASIN = 'FFFFE4B5';
    public const ORANGE = 'FFFFA500';
    public const PAPAYAWHIP = 'FFFFEFD5';
    public const BLANCHEDALMOND = 'FFFFEBCD';
    public const NAVAJOWHITE = 'FFFFDEAD';
    public const ANTIQUEWHITE = 'FFFAEBD7';
    public const TAN = 'FFD2B48C';
    public const BURLYWOOD = 'FFDEB887';
    public const BISQUE = 'FFFFE4C4';
    public const DARKORANGE = 'FFFF8C00';
    public const LINEN = 'FFFAF0E6';
    public const PERU = 'FFCD853F';
    public const PEACHPUFF = 'FFFFDAB9';
    public const SANDYBROWN = 'FFF4A460';
    public const CHOCOLATE = 'FFD2691E';
    public const SADDLEBROWN = 'FF8B4513';
    public const SEASHELL = 'FFFFF5EE';
    public const SIENNA = 'FFA0522D';
    public const LIGHTSALMON = 'FFFFA07A';
    public const CORAL = 'FFFF7F50';
    public const ORANGERED = 'FFFF4500';
    public const DARKSALMON = 'FFE9967A';
    public const TOMATO = 'FFFF6347';
    public const MISTYROSE = 'FFFFE4E1';
    public const SALMON = 'FFFA8072';
    public const SNOW = 'FFFFFAFA';
    public const LIGHTCORAL = 'FFF08080';
    public const ROSYBROWN = 'FFBC8F8F';
    public const INDIANRED = 'FFCD5C5C';
    public const RED = 'FFFF0000';
    public const BROWN = 'FFA52A2A';
    public const FIREBRICK = 'FFB22222';
    public const DARKRED = 'FF8B0000';
    public const MAROON = 'FF800000';
    public const WHITE = 'FFFFFFFF';
    public const WHITESMOKE = 'FFF5F5F5';
    public const GAINSBORO = 'FFDCDCDC';
    public const LIGHTGREY = 'FFD3D3D3';
    public const SILVER = 'FFC0C0C0';
    public const DARKGRAY = 'FFA9A9A9';
    public const GRAY = 'FF808080';
    public const DIMGRAY = 'FF696969';
    public const BLACK = 'FF000000';

    private const INDEXED_COLORS = [
        1 => 'FF000000', //  System Colour #1 - Black
        2 => 'FFFFFFFF', //  System Colour #2 - White
        3 => 'FFFF0000', //  System Colour #3 - Red
        4 => 'FF00FF00', //  System Colour #4 - Green
        5 => 'FF0000FF', //  System Colour #5 - Blue
        6 => 'FFFFFF00', //  System Colour #6 - Yellow
        7 => 'FFFF00FF', //  System Colour #7- Magenta
        8 => 'FF00FFFF', //  System Colour #8- Cyan
        9 => 'FF800000', //  Standard Colour #9
        10 => 'FF008000', //  Standard Colour #10
        11 => 'FF000080', //  Standard Colour #11
        12 => 'FF808000', //  Standard Colour #12
        13 => 'FF800080', //  Standard Colour #13
        14 => 'FF008080', //  Standard Colour #14
        15 => 'FFC0C0C0', //  Standard Colour #15
        16 => 'FF808080', //  Standard Colour #16
        17 => 'FF9999FF', //  Chart Fill Colour #17
        18 => 'FF993366', //  Chart Fill Colour #18
        19 => 'FFFFFFCC', //  Chart Fill Colour #19
        20 => 'FFCCFFFF', //  Chart Fill Colour #20
        21 => 'FF660066', //  Chart Fill Colour #21
        22 => 'FFFF8080', //  Chart Fill Colour #22
        23 => 'FF0066CC', //  Chart Fill Colour #23
        24 => 'FFCCCCFF', //  Chart Fill Colour #24
        25 => 'FF000080', //  Chart Line Colour #25
        26 => 'FFFF00FF', //  Chart Line Colour #26
        27 => 'FFFFFF00', //  Chart Line Colour #27
        28 => 'FF00FFFF', //  Chart Line Colour #28
        29 => 'FF800080', //  Chart Line Colour #29
        30 => 'FF800000', //  Chart Line Colour #30
        31 => 'FF008080', //  Chart Line Colour #31
        32 => 'FF0000FF', //  Chart Line Colour #32
        33 => 'FF00CCFF', //  Standard Colour #33
        34 => 'FFCCFFFF', //  Standard Colour #34
        35 => 'FFCCFFCC', //  Standard Colour #35
        36 => 'FFFFFF99', //  Standard Colour #36
        37 => 'FF99CCFF', //  Standard Colour #37
        38 => 'FFFF99CC', //  Standard Colour #38
        39 => 'FFCC99FF', //  Standard Colour #39
        40 => 'FFFFCC99', //  Standard Colour #40
        41 => 'FF3366FF', //  Standard Colour #41
        42 => 'FF33CCCC', //  Standard Colour #42
        43 => 'FF99CC00', //  Standard Colour #43
        44 => 'FFFFCC00', //  Standard Colour #44
        45 => 'FFFF9900', //  Standard Colour #45
        46 => 'FFFF6600', //  Standard Colour #46
        47 => 'FF666699', //  Standard Colour #47
        48 => 'FF969696', //  Standard Colour #48
        49 => 'FF003366', //  Standard Colour #49
        50 => 'FF339966', //  Standard Colour #50
        51 => 'FF003300', //  Standard Colour #51
        52 => 'FF333300', //  Standard Colour #52
        53 => 'FF993300', //  Standard Colour #53
        54 => 'FF993366', //  Standard Colour #54
        55 => 'FF333399', //  Standard Colour #55
        56 => 'FF333333', //  Standard Colour #56
    ];

    /**
     * @var int
     */
    public $colorIndex;
    /**
     * ARGB - Alpha RGB.
     *
     * @var string
     */
    protected $argb;

    /**
     * Constructor.
     *
     * @param string $colorValue
     * @see \EasyExcel\Metadata\Style\Color
     */
    public function __construct(string $colorValue = Color::BLACK)
    {
        $this->setArgb($colorValue);
    }

    /**
     * Adjust the brightness of a color.
     *
     * @param string $hex The colour as an RGBA or RGB value (e.g. FF00CCCC or CCDDEE)
     * @param float $adjustPercentage The percentage by which to adjust the colour as a float from -1 to 1
     *
     * @return string The adjusted colour as an RGBA or RGB value (e.g. FF00CCCC or CCDDEE)
     */
    public static function changeBrightness(string $hex, float $adjustPercentage): string
    {
        $rgba = (strlen($hex) === 8);

        $red = self::getRed($hex, false);
        $green = self::getGreen($hex, false);
        $blue = self::getBlue($hex, false);
        if ($adjustPercentage > 0) {
            $red += (255 - $red) * $adjustPercentage;
            $green += (255 - $green) * $adjustPercentage;
            $blue += (255 - $blue) * $adjustPercentage;
        } else {
            $red += $red * $adjustPercentage;
            $green += $green * $adjustPercentage;
            $blue += $blue * $adjustPercentage;
        }

        if ($red < 0) {
            $red = 0;
        } elseif ($red > 255) {
            $red = 255;
        }
        if ($green < 0) {
            $green = 0;
        } elseif ($green > 255) {
            $green = 255;
        }
        if ($blue < 0) {
            $blue = 0;
        } elseif ($blue > 255) {
            $blue = 255;
        }

        $rgb = strtoupper(
            str_pad(dechex((int) $red), 2, '0', 0) .
            str_pad(dechex((int) $green), 2, '0', 0) .
            str_pad(dechex((int) $blue), 2, '0', 0)
        );

        return (($rgba) ? 'FF' : '') . $rgb;
    }

    /**
     * Get the red colour component of an RGB value.
     *
     * @param string $RGB The colour as an RGB value (e.g. FF00CCCC or CCDDEE
     * @param bool $hex Flag indicating whether the component should be returned as a hex or a
     *                                    decimal value
     *
     * @return string The red colour component
     */
    public static function getRed(string $RGB, bool $hex = true): string
    {
        return self::getColourComponent($RGB, strlen($RGB) - 6, $hex);
    }

    /**
     * Get a specified colour component of an RGB value.
     *
     * @param string $RGB The colour as an RGB value (e.g. FF00CCCC or CCDDEE
     * @param int $offset Position within the RGB value to extract
     * @param bool $hex Flag indicating whether the component should be returned as a hex or a
     *                                    decimal value
     *
     * @return string The extracted colour component
     */
    private static function getColourComponent(string $RGB, int $offset, bool $hex = true): string
    {
        $colour = substr($RGB, $offset, 2);

        return ($hex) ? $colour : hexdec($colour);
    }

    /**
     * Get the green colour component of an RGB value.
     *
     * @param string $RGB The colour as an RGB value (e.g. FF00CCCC or CCDDEE
     * @param bool $hex Flag indicating whether the component should be returned as a hex or a
     *                                    decimal value
     *
     * @return string The green colour component
     */
    public static function getGreen(string $RGB, bool $hex = true): string
    {
        return self::getColourComponent($RGB, strlen($RGB) - 4, $hex);
    }

    /**
     * Get the blue colour component of an RGB value.
     *
     * @param string $RGB The colour as an RGB value (e.g. FF00CCCC or CCDDEE
     * @param bool $hex Flag indicating whether the component should be returned as a hex or a
     *                                    decimal value
     *
     * @return string The blue colour component
     */
    public static function getBlue(string $RGB, bool $hex = true): string
    {
        return self::getColourComponent($RGB, strlen($RGB) - 2, $hex);
    }

    /**
     * @param int $colorIndex
     * @param bool $background
     * @param array|null $palette
     * @return \EasyExcel\Metadata\Style\Color
     */
    public static function indexedColor(int $colorIndex, bool $background = false, ?array $palette = null): Color
    {
        if (empty($palette)) {
            if (isset(self::INDEXED_COLORS[$colorIndex])) {
                return new self(self::INDEXED_COLORS[$colorIndex]);
            }
        } elseif (isset($palette[$colorIndex])) {
            return new self($palette[$colorIndex]);
        }

        return ($background) ? new self(self::WHITE) : new self(self::BLACK);
    }

    /**
     * @param string $colorValue
     * @return $this
     */
    public function setRgb(string $colorValue): self
    {
        $this->setArgb($colorValue);

        return $this;
    }

    /**
     * @return string
     */
    public function getRgb(): string
    {
        return substr($this->argb ?? '', 2);
    }

    /**
     * @return string
     */
    public function getArgb(): string
    {
        return $this->argb ?? '';
    }

    /**
     * @param string $colorValue
     * @return $this
     */
    public function setArgb(string $colorValue): self
    {
        $this->argb = strlen($colorValue) === 8 ? $colorValue : ('FF' . $colorValue);

        return $this;
    }

    /**
     * @return string
     */
    public function getHashCode(): string
    {
        return md5(
            __CLASS__ .
            $this->getArgb()
        );
    }
}